- content_for :page_title, "Compras"

.container.mx-auto.px-6.py-6

  -# Header con navegaciÃ³n
  .flex.items-center.justify-between.mb-6
    %h1.text-3xl.font-bold.text-gray-900 Compras
    
    = link_to new_web_purchase_path, class: "inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-slate-700 hover:bg-slate-800 text-white text-sm font-semibold rounded-lg shadow-sm transition-colors" do
      %span +
      %span Nueva Compra

  -# Mostrar mensaje de Ã©xito si existe
  - if flash[:notice]
    .bg-green-50.border-l-4.border-green-500.p-4.rounded-lg.mb-6.flex.items-start.gap-3
      .w-10.h-10.rounded-xl.bg-green-500.flex.items-center.justify-center.text-white.flex-shrink-0
        âœ“
      .flex-1
        %h4.font-semibold.text-green-800.mb-1 Ã‰xito
        %p.text-sm.text-green-700= flash[:notice]

  -# Lista de compras
  - if @purchases.any?
    .bg-white.border.border-slate-200.rounded-lg.overflow-hidden
      %table.min-w-full.divide-y.divide-slate-200
        %thead.bg-slate-50
          %tr
            %th.px-4.py-3.text-left.text-xs.font-medium.text-slate-500.uppercase.tracking-wider
              Fecha
            %th.px-4.py-3.text-left.text-xs.font-medium.text-slate-500.uppercase.tracking-wider
              Proveedor
            %th.px-4.py-3.text-left.text-xs.font-medium.text-slate-500.uppercase.tracking-wider
              Productos
            %th.px-4.py-3.text-left.text-xs.font-medium.text-slate-500.uppercase.tracking-wider
              Moneda
            %th.px-4.py-3.text-right.text-xs.font-medium.text-slate-500.uppercase.tracking-wider
              Total
            %th.px-4.py-3.text-center.text-xs.font-medium.text-slate-500.uppercase.tracking-wider
              Estado
        
        %tbody.divide-y.divide-slate-100.bg-white
          - @purchases.each do |purchase|
            %tr.hover:bg-slate-50.transition-colors
              %td.px-4.py-3.whitespace-nowrap
                %p.text-sm.text-slate-900= purchase.purchase_date.strftime("%d/%m/%Y")
                %p.text-xs.text-slate-500= purchase.created_at.strftime("%H:%M")
              
              %td.px-4.py-3.whitespace-nowrap
                %p.text-sm.font-medium.text-slate-900= purchase.supplier.name
              
              %td.px-4.py-3
                = link_to web_product_path(purchase), class: "text-slate-700" do
                  %p.text-sm.text-slate-700
                    = purchase.purchase_items.count
                    = purchase.purchase_items.count == 1 ? 'producto' : 'productos'
                  %p.text-xs.text-slate-500
                    = purchase.purchase_items.sum(:quantity)
                    unidades
              
              %td.px-4.py-3.whitespace-nowrap
                %span.inline-flex.items-center.px-2.5.py-1.rounded-md.text-xs.font-medium{ class: purchase.currency == 'USD' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800' }
                  = purchase.currency
              
              %td.px-4.py-3.whitespace-nowrap.text-right
                %p.text-sm.font-bold.text-slate-900
                  = purchase.currency
                  = number_with_delimiter(purchase.total_cost, delimiter: '.', separator: ',', precision: 2)
                - if purchase.currency == 'USD' && purchase.exchange_rate
                  %p.text-xs.text-slate-500
                    â‰ˆ ARS
                    = number_with_delimiter(purchase.calculate_total_ars, delimiter: '.', separator: ',', precision: 0)
              
              %td.px-4.py-3.whitespace-nowrap.text-center
                - if purchase.confirmed_status?
                  %span.inline-flex.items-center.px-2.5.py-1.rounded-md.text-xs.font-medium.bg-emerald-100.text-emerald-800
                    Confirmada
                - elsif purchase.cancelled_status?
                  %span.inline-flex.items-center.px-2.5.py-1.rounded-md.text-xs.font-medium.bg-slate-100.text-slate-700
                    Anulada

  - else
    .bg-white.border.border-slate-200.rounded-lg.p-16.text-center
      .inline-flex.w-20.h-20.rounded-full.bg-gray-100.items-center.justify-center.text-4xl.mb-4
        ðŸ“¥
      %h3.text-xl.font-bold.text-gray-900.mb-2 No hay compras registradas
      %p.text-gray-600.mb-6 ComenzÃ¡ registrando la primera compra de mercaderÃ­a
      = link_to new_web_purchase_path, class: "inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-slate-700 hover:bg-slate-800 text-white text-sm font-semibold rounded-lg shadow-sm transition-colors" do
        %span +
        %span Nueva Compra
